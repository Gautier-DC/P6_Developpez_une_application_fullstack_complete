<h1 class="profile-title">Profil utilisateur</h1>
<mat-card class="profile-form">
  <mat-card-content>
    <form class="profile-form-content">
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Username</mat-label>
        <input
          matInput
          [(ngModel)]="userProfile.username"
          name="username"
          placeholder="Username"
          required
          [disabled]="isLoading"
        />
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Email</mat-label>
        <input
          matInput
          type="email"
          [(ngModel)]="userProfile.email"
          name="email"
          placeholder="email@email.fr"
          required
          [disabled]="isLoading"
        />
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Mot de passe</mat-label>
        <input
          matInput
          type="password"
          [(ngModel)]="userProfile.password"
          name="password"
          placeholder="Mot de passe (optionnel)"
          [disabled]="isLoading"
          appPasswordValidation
          #passwordField="ngModel"
          matTooltip="Minimum 8 caractères : une majuscule, une minuscule, un chiffre et un caractère spécial"
          matTooltipPosition="above"
        />
        <mat-hint>Laisser vide pour conserver le mot de passe actuel</mat-hint>
        @if (passwordField.invalid && passwordField.touched &&
        userProfile.password.trim()) {
        <mat-error>{{ getPasswordErrorMessage(passwordField) }}</mat-error>
        }
      </mat-form-field>

      <button
        mat-raised-button
        color="primary"
        class="save-button"
        [disabled]="isLoading"
        (click)="onSaveProfile()"
      >
        @if (isLoading) {
        <mat-spinner diameter="20" style="margin-right: 8px"></mat-spinner>
        Mise à jour... } @else { Sauvegarder }
      </button>
    </form>
  </mat-card-content>
</mat-card>

<!-- Subscriptions Section -->
<div class="subscriptions-section">
  <mat-divider></mat-divider>
  <h2 class="subscriptions-title">Abonnements</h2>

  @if (isLoadingSubscriptions) {
  <div class="loading-container">
    <mat-spinner></mat-spinner>
  </div>
  } @else { @if (subscribedThemes.length === 0) {
  <p class="no-subscriptions">
    Vous n'êtes abonné à aucun thème pour le moment.
  </p>
  } @else {
  <div class="subscriptions-grid">
    @for (theme of subscribedThemes; track theme.id) {
    <app-card
      [title]="theme.name"
      [description]="theme.description"
      buttonText="Se désabonner"
      buttonColor="primary"
      (buttonClick)="onUnsubscribe(theme)"
    ></app-card>
    }
  </div>
  } }
</div>
