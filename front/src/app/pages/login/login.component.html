<app-minimalist-header></app-minimalist-header>
<main>
  <section>
    <div class="container">
      <app-back-button></app-back-button>
      <img src="assets/logo_p6.png" alt="MDD Logo" class="logo-hero" />
      <div class="login-card">
        <mat-card>
          <h1 class="title">Se connecter</h1>
          <mat-card-content>
            <!-- Message de succès -->
            @if (successMessage) {
            <div class="success-message">
              <mat-icon color="primary">check_circle</mat-icon>
              <span>{{ successMessage }}</span>
            </div>
            }

            <form
              [formGroup]="loginForm"
              (ngSubmit)="onSubmit()"
              class="login-form"
            >
              <!-- Email field -->
              <mat-label>Adresse email</mat-label>
              <mat-form-field appearance="outline">
                <input
                  matInput
                  type="email"
                  formControlName="email"
                  placeholder="votre@email.com"
                />
                @if (loginForm.get('email')?.hasError('required')) {
                <mat-error> L'email est requis </mat-error>
                } @if (loginForm.get('email')?.hasError('email')) {
                <mat-error> Format d'email invalide </mat-error>
                }
              </mat-form-field>

              <!-- Password field -->
              <mat-label>Mot de passe</mat-label>
              <mat-form-field appearance="outline">
                <input
                  matInput
                  [type]="hidePassword ? 'password' : 'text'"
                  formControlName="password"
                  placeholder="Votre mot de passe"
                />
                <button
                  mat-icon-button
                  matSuffix
                  (click)="hidePassword = !hidePassword"
                  type="button"
                >
                  <mat-icon>{{
                    hidePassword ? "visibility_off" : "visibility"
                  }}</mat-icon>
                </button>
                @if (loginForm.get('password')?.hasError('required')) {
                <mat-error> Le mot de passe est requis </mat-error>
                } @if (loginForm.get('password')?.hasError('minlength')) {
                <mat-error> Au moins 6 caractères requis </mat-error>
                }
              </mat-form-field>

              <!-- Error message -->
              @if (errorMessage) {
              <div class="error-message">
                <mat-icon color="warn">error</mat-icon>
                <span>{{ errorMessage }}</span>
              </div>
              }

              <!-- Submit button -->
              <div class="button-container">
                <button
                  mat-raised-button
                  color="primary"
                  type="submit"
                  [disabled]="loginForm.invalid || isLoading"
                >
                  @if (isLoading) {
                  <mat-spinner diameter="20"></mat-spinner>
                  Connexion... } @else { Se connecter }
                </button>

                <a matButton type="link" (click)="goToRegister()">
                  Pas encore de compte ? S'inscrire
                </a>
              </div>
            </form>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </section>
</main>
